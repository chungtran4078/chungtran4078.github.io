<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.47108c02bcddbdfcd93a.css" data-identity="gatsby-global-css">code[class*=language-],pre[class*=language-]{word-wrap:normal;background:none;color:#ccc;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;text-align:left;white-space:pre;word-break:normal;word-spacing:normal}pre[class*=language-]{margin:.5em 0;overflow:auto;padding:1em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{border-radius:.3em;padding:.1em;white-space:normal}.token.block-comment,.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.deleted,.token.namespace,.token.tag{color:#e2777a}.token.function-name{color:#6196cc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.constant,.token.property,.token.symbol{color:#f8c555}.token.atrule,.token.builtin,.token.important,.token.keyword,.token.selector{color:#cc99cd}.token.attr-value,.token.char,.token.regex,.token.string,.token.variable{color:#7ec699}.token.entity,.token.operator,.token.url{color:#67cdcc}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.token.inserted{color:green}pre[class*=language-].line-numbers{counter-reset:linenumber;padding-left:3.8em;position:relative}pre[class*=language-].line-numbers>code{position:relative;white-space:inherit}.line-numbers .line-numbers-rows{border-right:1px solid #999;font-size:100%;left:-3.8em;letter-spacing:-1px;pointer-events:none;position:absolute;top:0;-webkit-user-select:none;-ms-user-select:none;user-select:none;width:3em}.line-numbers-rows>span{counter-increment:linenumber;display:block}.line-numbers-rows>span:before{color:#999;content:counter(linenumber);display:block;padding-right:.8em;text-align:right}html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol}body{font-size:1.1rem;margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{-webkit-text-decoration-skip:objects;background-color:transparent}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{box-sizing:border-box;font-size:130.5%/1.45em;overflow-y:scroll}*,:after,:before{box-sizing:inherit}body{word-wrap:break-word;color:rgba(0,0,0,.8);font-weight:400}img{margin:0 0 1.45rem;max-width:100%;padding:0}h1,h2,h3,h4,h5,h6{text-rendering:optimizeLegibility;color:inherit;font-weight:600;margin:0 0 .5em;padding:0}h1{font-size:2.25rem}h2{font-size:1.8em}h3{font-size:1.6em}h4{font-size:1rem}h5{font-size:.875em}h6{font-size:.85em}hgroup{margin:0 0 1.45rem;padding:0}ol,ul{list-style-image:none;list-style-position:outside;margin:0 0 1.45rem 1.45rem;padding:0}dd,dl,p{margin:0 0 1.45rem;padding:0}p{line-height:1.5}figure{padding:0}figure,pre{margin:0 0 1.45rem}pre{word-wrap:normal;background:rgba(0,0,0,.04);border-radius:3px;font-size:.85rem;line-height:1.42;overflow:auto;padding:1.45rem}table{border-collapse:collapse;font-size:1rem;line-height:1.45rem;width:100%}fieldset,table{margin:0 0 1.45rem;padding:0}blockquote{border-left:2px solid #999;font-style:italic;margin:5px auto;padding:.5em}blockquote:before{display:none}blockquote:not(:first-of-type){margin-top:.5em}blockquote p{color:#555;font-size:12pt;line-height:1.4}blockquote footer{color:#777;font-size:12pt;margin-top:.5em;padding:0;text-align:left}blockquote footer:before{content:"— "}@element "blockquote" and (min-width: 300px){blockquote{padding:1em 20% 1em 1em}blockquote p{font-size:14pt}}form,iframe,noscript{margin:0 0 1.45rem;padding:0}hr{background:rgba(0,0,0,.2);border:none;height:1px;margin:0 0 calc(1.45rem - 1px);padding:0}address{margin:0 0 1.45rem;padding:0}b,dt,strong,th{font-weight:700}li{margin-bottom:.725rem}ol li,ul li{padding-left:0}li>ol,li>ul{margin-bottom:.725rem;margin-left:1.45rem;margin-top:.725rem}blockquote :last-child,li :last-child,p :last-child{margin-bottom:0}li>p{margin-bottom:.725rem}code,kbd,samp{font-size:.85rem;line-height:1.45rem}abbr,abbr[title],acronym{border-bottom:1px dotted rgba(0,0,0,.5);cursor:help}abbr[title]{text-decoration:none}td,th,thead{text-align:left}td,th{font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";border-bottom:1px solid rgba(0,0,0,.12);padding:.725rem .96667rem calc(.725rem - 1px)}td:first-child,th:first-child{padding-left:0}td:last-child,th:last-child{padding-right:0}@media only screen and (max-width:480px){html{font-size:100%}}footer{margin-top:1em}.site-title{font-size:2em;font-weight:700;margin-bottom:10px}.site-title a{color:inherit;text-decoration:none}.site-sub-title{font-style:italic;margin-bottom:0}.post-title{margin-bottom:0}h3.post-title{font-size:1.2em}.post-tag-container{margin:10px 0}.post-meta{margin-bottom:5px}.post-content p{line-height:1.8}.post-content h2{border-bottom:1px solid #eaecef;padding-bottom:.3em}button{cursor:pointer}a{color:#639;text-decoration:none}ul.prev-next{list-style:none;margin-left:0}ul.prev-next li span{font-weight:700;margin-right:.5em}code,tt{background-color:rgba(0,0,0,.04);border-radius:3px;font-family:SFMono-Regular,Consolas,Roboto Mono,Droid Sans Mono,Liberation Mono,Menlo,Courier,monospace;padding:.2em 0}:not(pre)>code[class*=language-]{border-radius:.2em;padding:.15em}pre code{background:none;line-height:1.42}code:after,code:before,tt:after,tt:before{letter-spacing:-.2em}pre code:after,pre code:before,pre tt:after,pre tt:before{content:""}:not(pre)>code[class*=language-text]{background:#f1f1f1;color:inherit}code[class*=language-],pre[class*=language-]{font-size:.9rem}.gatsby-highlight-code-line{background-color:#717171;border-left:.25em solid #6196cc;display:block;margin-left:-1em;margin-right:-1em;padding-left:.75em;padding-right:1em}.gatsby-highlight{background-color:#2d2d2d;border-radius:.2em;margin:.5em 0;overflow:auto;padding:1em}.gatsby-highlight pre[class*=language-]{background-color:transparent;float:left;margin:0;min-width:100%;overflow:initial;padding:0}.gatsby-highlight pre[class*=language-].line-numbers{overflow:initial;padding:0 0 0 2.8em}</style><meta name="generator" content="Gatsby 3.12.0"/><title data-react-helmet="true">Docker cho bé - P3: Chạy nhiều container với Docker-compose | Chung Tran</title><meta data-react-helmet="true" name="description" content="Đến đây chúng ta có thể sử dụng Dockerfile để khởi tạo một server và cài đặt các service cần thiết lên đó rồi. Tuy nhiên sẽ có những bất cập, đó là chúng ta…"/><meta data-react-helmet="true" property="og:title" content="Docker cho bé - P3: Chạy nhiều container với Docker-compose"/><meta data-react-helmet="true" property="og:description" content="Đến đây chúng ta có thể sử dụng Dockerfile để khởi tạo một server và cài đặt các service cần thiết lên đó rồi. Tuy nhiên sẽ có những bất cập, đó là chúng ta…"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" property="og:image" content="https://avatars1.githubusercontent.com/u/28822504?s=400&amp;v=4"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="@chungtran4078"/><meta data-react-helmet="true" name="twitter:title" content="Docker cho bé - P3: Chạy nhiều container với Docker-compose"/><meta data-react-helmet="true" name="twitter:description" content="Đến đây chúng ta có thể sử dụng Dockerfile để khởi tạo một server và cài đặt các service cần thiết lên đó rồi. Tuy nhiên sẽ có những bất cập, đó là chúng ta…"/><meta data-react-helmet="true" name="google-site-verification" content="OXO63UNlYgp3J5znjIDm1AWeHj7MCcoSLxJV3ucTSUo"/><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){if(void 0===e.target.dataset.mainImage)return;if(void 0===e.target.dataset.gatsbyImageSsr)return;const t=e.target;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><link rel="icon" href="/favicon-32x32.png?v=4a9773549091c227cd2eb82ccd9c5e3a" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="sitemap" type="application/xml" href="/sitemap/sitemap-index.xml"/><link as="script" rel="preload" href="/webpack-runtime-48b05e61d3448c9a5b3b.js"/><link as="script" rel="preload" href="/framework-d48b262dedbf1fafd12c.js"/><link as="script" rel="preload" href="/app-fd454e6b17fe15d481e1.js"/><link as="script" rel="preload" href="/commons-7811b15a21818df9f744.js"/><link as="script" rel="preload" href="/component---src-templates-blog-post-tsx-7b28b2b100cbd4db9766.js"/><link as="fetch" rel="preload" href="/page-data/docker-cho-be-p3/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/3649515864.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/3894061898.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div><div style="margin:0 auto;max-width:960px;padding:1.45rem 1.0875rem"><div class="site-title"><a href="/">Chung Tran</a></div><p class="site-sub-title">Lôm côm, ba lăng nhăng.</p></div><div style="margin:0 auto;max-width:960px;padding:0px 1.0875rem 1.45rem;padding-top:0"><div class="post-meta"><h1 class="post-title">Docker cho bé - P3: Chạy nhiều container với Docker-compose</h1><small>Date: <!-- -->2019-05-19<!-- --> | Category: <a style="text-decoration:none" href="/categories/docker">Docker</a></small></div><hr/><div class="post-content"><div><p>Đến đây chúng ta có thể sử dụng <strong>Dockerfile</strong> để khởi tạo một server và cài đặt các service cần thiết lên đó rồi.</p>
<p>Tuy nhiên sẽ có những bất cập, đó là chúng ta phải cài tất cả service lên 1 container (kiến trúc 1 khối - monolithic), mà các service này lại phải cài đặt thủ công (<code class="language-text">apt-get install xxxyyy</code> gì gì đó), trong khi chúng ta muốn sử dụng các image service có sẵn trên Docker hub ???</p>
<p>Hoặc 1 dự án thực tế sử dụng các service chạy độc lập (kiến trúc nhiều dịch vụ - microservice) chẳng lẽ chúng ta lại phải viết vài cái <strong>Dockerfile</strong> nữa sao. Không không, ở đây chúng ta không làm như vậy.</p>
<p>Vậy giải pháp là <strong>Docker compose</strong> (nghe giống giống cái <strong>php composer</strong> nhỉ, thực ra có giống đấy, lát mình nói sau).</p>
<p><strong>Docker compose</strong> là công cụ cho phép chúng ta run nhiều container 1 lúc, mình có chém qua về nó ở P1.</p>
<blockquote>
<p>Docker compose: thay vì cài đặt tất cả service (mysql, php, redis…) lên 1 container thì chúng ta có thể sử dụng docker-compose để chạy mỗi service trên mỗi container và kết nối các container lại với nhau. Giống như một hệ thống thực tế vậy.</p>
</blockquote>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; "
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/24ae150e7b2b17a62701bda7ca132c75/00d43/docker-compose.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 39.86486486486486%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsTAAALEwEAmpwYAAABXElEQVQY03WRS0/CUBBG+19144aNiVtXLjTGV2IqMUYMEiKPVsRWKLTIo4i1lodQsaRBoIIUASMUlKb3GqksaPRbzszJ5MwgcD4AAAMACGFdeUndFTCCCTE38J8gFhJMye5b58jHnEUEki0d+ygiTJtdKwxm1d+FtfqCg1lxUqG4wAhVmpcpTlpd3xtoIwjhxDAMAPXpKIAQ4QsP1HUyWxQZNhNjMzccv7Tjxtg8wwpUSqAzRdRF7NsdYrsXU/p0rXspq4SshqudeKOHVKrPolR5rMjFssRl893+e0mUdF2vKc1w8h6PpLdQhw3F1/yJJ6U10IHc1xof48Zg3Bx+IhaNr8nEc0HxuRIWpNxk2n2VDpDRxV2PDT3vq68WcwTM8mMDoaaNnN7godPnCxCbBy4/TmyjJ2Qoms8XTAwAaArPXdvstdpqLMXd5sr2UywYSSzjwoY3pg2Hf77qG8IOpDO963/pAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Docker composer"
        title="Docker composer"
        src="/static/24ae150e7b2b17a62701bda7ca132c75/fcda8/docker-compose.png"
        srcset="/static/24ae150e7b2b17a62701bda7ca132c75/12f09/docker-compose.png 148w,
/static/24ae150e7b2b17a62701bda7ca132c75/e4a3f/docker-compose.png 295w,
/static/24ae150e7b2b17a62701bda7ca132c75/fcda8/docker-compose.png 590w,
/static/24ae150e7b2b17a62701bda7ca132c75/efc66/docker-compose.png 885w,
/static/24ae150e7b2b17a62701bda7ca132c75/00d43/docker-compose.png 1000w"
        sizes="(max-width: 590px) 100vw, 590px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
        decoding="async"
      />
  </a>
    </span></p>
<h2>Cài đặt</h2>
<p>Mình xài Windows cài xong Docker cái thấy nó có sẵn <strong>Docker compose</strong> luôn, ai xài Linux thì tham khảo hướng dẫn ở đây nha <a href="https://docs.docker.com/compose/install/" target="_blank" rel="nofollow">https://docs.docker.com/compose/install/</a></p>
<p>Kiểm tra xem cài đặt thành công chưa</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">docker-compose -v</code></pre></div>
<h2>Viết docker-compose.yml</h2>
<p>Trước tiên phải xác định các container sẽ sử dụng trong project. Ví dụ dự án mình là dự án php cần có 1 máy chạy source code và 1 máy để chạy mysql. Vậy là mình cần có 2 container.</p>
<p>Như vậy nội dung file <strong>docker-compose.yml</strong> cho project của mình về cơ bản sẽ như sau:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">version: <span class="token string">'3.5'</span>
services:
    php-apache:
        build: <span class="token builtin class-name">.</span>
        ports:
            - <span class="token number">8080</span>:80 <span class="token comment">#&lt;host>:&lt;container></span>
        volumes:
            - ./source:/var/www/html <span class="token comment">#Mapping source code giữa máy thật (host) và container</span>
            - ./apache/log:/var/log/apache2
        links:
            - mysql
        environment:
            DB_HOST: mysql <span class="token comment">#Là tên của container database nha</span>
            DB_PORT: <span class="token number">3306</span>
            DB_NAME: my-db
            DB_USER: devuser
            DB_PWD: devuser
    mysql:
        image: mysql:5.6
        ports:
            - <span class="token string">"3307:3306"</span> <span class="token comment">#&lt;host>:&lt;container></span>
        environment:
            MYSQL_ROOT_PASSWORD: root <span class="token comment">#Mặc định đã có user root rồi nên chỉ cần thiết lập password cho user này.</span>
            MYSQL_DATABASE: my-db <span class="token comment">#Tạo sẵn db my-db</span>
            MYSQL_USER: devuser <span class="token comment">#User này sẽ được tạo và grant cho my-db, không để root vì user root mặc định có sẵn rồi.</span>
            MYSQL_PASSWORD: devuser
        volumes: <span class="token comment">#Vì dữ liệu sẽ mất nếu stop container vì vậy phải backup data vào máy thật</span>
            - ./db/data:/var/lib/mysql 
            - ./db/log:/var/log/mysql</code></pre></div>
<p>Và nội dung của <strong>Dockerfile</strong> như sau:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">FROM php:7.3-apache
<span class="token comment">#https://hub.docker.com/_/php</span>
LABEL <span class="token assign-left variable">maintainer</span><span class="token operator">=</span><span class="token string">"ChungTran&lt;chungtran4078@gmail.com>"</span>
RUN docker-php-ext-install pdo pdo_mysql mysqli
RUN <span class="token function">cp</span> <span class="token string">"<span class="token variable">$PHP_INI_DIR</span>/php.ini-production"</span> <span class="token string">"<span class="token variable">$PHP_INI_DIR</span>/php.ini"</span>
RUN <span class="token function">apt-get</span> update <span class="token operator">&amp;&amp;</span> <span class="token function">apt-get</span> <span class="token function">install</span> -y <span class="token function">vim</span></code></pre></div>
<h4>** Giải thích chút:</h4>
<p>Cấu trúc file <strong>docker-compose.yml</strong> của mình ở trên như sau:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">version: <span class="token string">'3.5'</span>
services:
    php-apache:
        <span class="token punctuation">..</span>.
    mysql:
        <span class="token punctuation">..</span>.</code></pre></div>
<ul>
<li>Mỗi container là một <em>service</em>, ở đây mình có 2 service có tên <em>php-apache</em> và <em>mysql</em> (tên này do mình tự đặt nha)</li>
</ul>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">php-apache:
        build: <span class="token builtin class-name">.</span></code></pre></div>
<p>Chỗ này là lý do có file <strong>Dockerfile</strong> ở trên. Do mình muốn cài đặt thêm một số thành phần nên mình sẽ chạy service này với image build từ <strong>Dockerfile</strong>.</p>
<p>Hiện tại file <strong>Dockerfile</strong> đang ở cùng cấp với file <strong>docker-compose.yml</strong> nên mình để <code class="language-text">build: .</code> nha, nếu <strong>Dockerfile</strong> nằm thư mục khác, VD <em>docker</em> thì:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">build:
    context: ./docker</code></pre></div>
<p>**<em>Lưu ý: <strong>docker-compose.yml</strong> có version nha các bạn, ở VD trên mình đang dùng <code class="language-text">version 3.5</code>, các version có thể khác nhau về một số cú pháp, chi tiết tại đây: <a href="https://docs.docker.com/compose/compose-file/compose-versioning/" target="_blank" rel="nofollow">https://docs.docker.com/compose/compose-file/compose-versioning/</a></em></p>
<p>Ok xong xuôi, thực hiện <code class="language-text">docker-composer up</code>, ta sẽ thấy các container lần lượt được start.</p>
<p>Bây giờ nếu nhấn Ctrl + C thì các container sẽ stop, trường hợp này sử dụng <code class="language-text">docker-composer up -d</code> để chạy với chế độ nền.</p>
<p>##Testing
Vào thư mục <em>source</em>, tạo file <em>index.php</em>:</p>
<div class="gatsby-highlight" data-language="php"><pre class="language-php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token variable">$dbhost</span> <span class="token operator">=</span> <span class="token variable">$_ENV</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'DB_HOST'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token variable">$username</span> <span class="token operator">=</span> <span class="token variable">$_ENV</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'DB_USER'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$password</span> <span class="token operator">=</span> <span class="token variable">$_ENV</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'DB_PWD'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$dbname</span> <span class="token operator">=</span> <span class="token variable">$_ENV</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'DB_NAME'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$port</span> <span class="token operator">=</span> <span class="token variable">$_ENV</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'DB_PORT'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment">// Create connection</span>
<span class="token variable">$conn</span> <span class="token operator">=</span> <span class="token function">mysqli_connect</span><span class="token punctuation">(</span><span class="token variable">$dbhost</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">,</span> <span class="token variable">$password</span><span class="token punctuation">,</span> <span class="token variable">$dbname</span><span class="token punctuation">,</span> <span class="token variable">$port</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Check connection</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$conn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Connection failed: "</span> <span class="token operator">.</span> <span class="token function">mysqli_connect_error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">echo</span> <span class="token string double-quoted-string">"Connected successfully"</span><span class="token punctuation">;</span></span></code></pre></div>
<p>Sau đó truy cập <code class="language-text">localhost:8080</code> để xem kết quả.</p>
<p>Một số trường hợp có thể sẽ xảy ra lỗi <code class="language-text">Call to undefined function mysqli_connect()</code> hoặc <code class="language-text">Connection refused</code> hoặc <code class="language-text">No such file or directory</code> thì kiểm tra lại file <strong>php.ini</strong> trong <code class="language-text">/usr/local/etc/php</code> nhé.</p>
<ul>
<li>Enable mysqli extension (extension=mysqli)</li>
<li>Kiểm tra giá trị của <code class="language-text">variables_order</code>, sửa lại thành “EGPCS”. Đây là chuỗi ký tự đại diện cho các biến môi trường (<a href="http://php.net/variables-order" target="_blank" rel="nofollow">http://php.net/variables-order</a>)</li>
</ul>
<h3>Thế Docker Compose thì liên quan gì PHP Composer?</h3>
<p>CHẢ LIÊN QUAN.</p>
<p>Nhưng mục đích thì có phần giống nhau.</p>
<ul>
<li>php composer: cứ nhập tên package vào file <code class="language-text">composer.json</code>, composer sẽ làm việc còn lại.</li>
<li>docker compose:  cứ nhập tên service và image đi kèm vào file <code class="language-text">docker-compose.yml</code>, docker compose sẽ làm việc còn lại.</li>
</ul></div></div><div class="post-tag-container"><span>Tags: </span><a style="text-decoration:none" href="/tags/linux"><button>linux</button></a><a style="text-decoration:none" href="/tags/docker"><button>docker</button></a><a style="text-decoration:none" href="/tags/development-tools"><button>development tools</button></a></div><hr/><ul class="prev-next"><li><span>Prev:</span><a rel="prev" href="/docker-cho-be-p2/">Docker cho bé - P2: Build image từ Dockerfile</a></li><li><span>Next:</span><a rel="next" href="/deploy-nodejs-app-using-nginx-pm2/">Deploy Nodejs app sử dụng Nginx + PM2</a></li></ul><footer>© me 2018, Built with <a target="_blank" rel="noopener noreferrer" href="https://www.gatsbyjs.org">Gatsby</a></footer></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/docker-cho-be-p3/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-e66811e0b6688dcb4ebf.js"],"app":["/app-fd454e6b17fe15d481e1.js"],"component---src-pages-404-jsx":["/component---src-pages-404-jsx-6e2e6289dc996384000d.js"],"component---src-pages-index-tsx":["/component---src-pages-index-tsx-b9cb8ae60e6fba99e8c6.js"],"component---src-templates-blog-post-tsx":["/component---src-templates-blog-post-tsx-7b28b2b100cbd4db9766.js"],"component---src-templates-category-tsx":["/component---src-templates-category-tsx-d7a9e4fde2393c584ae5.js"],"component---src-templates-tag-tsx":["/component---src-templates-tag-tsx-5f8055ed686dece0b499.js"]};/*]]>*/</script><script src="/polyfill-e66811e0b6688dcb4ebf.js" nomodule=""></script><script src="/component---src-templates-blog-post-tsx-7b28b2b100cbd4db9766.js" async=""></script><script src="/commons-7811b15a21818df9f744.js" async=""></script><script src="/app-fd454e6b17fe15d481e1.js" async=""></script><script src="/framework-d48b262dedbf1fafd12c.js" async=""></script><script src="/webpack-runtime-48b05e61d3448c9a5b3b.js" async=""></script></body></html>