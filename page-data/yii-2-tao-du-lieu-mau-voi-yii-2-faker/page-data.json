{"componentChunkName":"component---src-templates-blog-post-js","path":"/yii-2-tao-du-lieu-mau-voi-yii-2-faker/","result":{"data":{"site":{"siteMetadata":{"title":"Chung Tran","author":"@chungtran4078"}},"markdownRemark":{"id":"60f3a2f1-326b-50a7-a385-a9afb4b382f0","excerpt":"Trong Yii2 core extension có hỗ trợ sẵn phần mở rộng  hỗ trợ cho việc tạo dữ liệu mẫu dựa trên cấu trúc do ta định nghĩa sẵn. Cài đặt Hoặc thêm dòng sau vào :…","html":"<p>Trong <a href=\"https://www.yiiframework.com/doc/guide/2.0/en/structure-extensions#core-extensions\" target=\"_blank\" rel=\"nofollow\">Yii2 core extension</a> có hỗ trợ sẵn phần mở rộng <code class=\"language-text\">Yii 2 Faker</code> hỗ trợ cho việc tạo dữ liệu mẫu dựa trên cấu trúc do ta định nghĩa sẵn.</p>\n<h2>Cài đặt</h2>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">composer require yiisoft/yii2-faker</code></pre></div>\n<!--more-->\n<p>Hoặc thêm dòng sau vào <code class=\"language-text\">composer.json</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token property\">\"yiisoft/yii2-faker\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"~2.0.0\"</span></code></pre></div>\n<h2>Cách dùng</h2>\n<p>Ở đây mình thực hiện trên <strong>Yii 2 Advanced</strong>, <strong>Yii 2 Basic</strong> cũng tương tự nhé.</p>\n<ul>\n<li>Mở file <code class=\"language-text\">console/config/main.php</code> và config cho <code class=\"language-text\">controllerMap</code> như sau:</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token single-quoted-string string\">'controllerMap'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span>\n        <span class=\"token single-quoted-string string\">'fixture'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span>\n            <span class=\"token single-quoted-string string\">'class'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token single-quoted-string string\">'yii\\faker\\FixtureController'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token single-quoted-string string\">'templatePath'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token single-quoted-string string\">'@common/tests/templates/fixtures'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// thư mục chứa template để định nghĩa cấu trúc dữ liệu</span>\n            <span class=\"token single-quoted-string string\">'fixtureDataPath'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token single-quoted-string string\">'@common/tests/fixtures/data'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// file data sẽ được xuất ra ở đây</span>\n        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>Tạo file template:</li>\n</ul>\n<p>VD mình tạo template dữ liệu cho bảng <strong>User</strong> như sau:</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token comment\">// tạo file user.php nằm trong thư mục @common/tests/templates/fixtures</span>\n<span class=\"token comment\">/**\n * @var $faker \\Faker\\Generator\n * @var $index integer\n */</span>\n<span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token single-quoted-string string\">'name'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token variable\">$faker</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">firstName</span><span class=\"token punctuation\">,</span>\n    <span class=\"token single-quoted-string string\">'phone'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token variable\">$faker</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">phoneNumber</span><span class=\"token punctuation\">,</span>\n    <span class=\"token single-quoted-string string\">'city'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token variable\">$faker</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">city</span><span class=\"token punctuation\">,</span>\n    <span class=\"token single-quoted-string string\">'password'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> Yii<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token variable\">$app</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">getSecurity</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">generatePasswordHash</span><span class=\"token punctuation\">(</span><span class=\"token single-quoted-string string\">'password_'</span> <span class=\"token punctuation\">.</span> <span class=\"token variable\">$index</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token single-quoted-string string\">'auth_key'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> Yii<span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token variable\">$app</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">getSecurity</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">generateRandomString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token single-quoted-string string\">'intro'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token variable\">$faker</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">sentence</span><span class=\"token punctuation\">(</span><span class=\"token number\">7</span><span class=\"token punctuation\">,</span> <span class=\"token boolean constant\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\">// generate a sentence with 7 words</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>Thực hiện chạy command sau để xuất ra data mẫu:</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">// câu lệnh này sẽ xuất ra mặc định <span class=\"token number\">2</span> record\nphp yii fixture/generate user\n\n// câu lệnh này sẽ xuất ra <span class=\"token number\">5</span> record với ngôn ngữ Tiếng Việt\nphp yii fixture/generate user --count<span class=\"token operator\">=</span><span class=\"token number\">5</span> --language<span class=\"token operator\">=</span><span class=\"token string\">\"vi_VN\"</span></code></pre></div>\n<p>Kiểm tra thư mục <code class=\"language-text\">common/tests/fixtures/data</code> sẽ thấy file <code class=\"language-text\">user.php</code> được tạo cùng với mảng chứa data bên trong.</p>\n<h2>Custom dữ liệu</h2>\n<p>Trong nhiều trường hợp có thể các hàm viết sẵn của Faker có thể đáp ứng nhu cầu của chúng ta, tuy nhiên khi cần những dữ liệu đặc biệt thì phải làm thế nào?.</p>\n<p>VD mình cần xuất ra dữ liệu mẫu của số điện thoại phải có mã quốc gia +84 ở phía trước, lúc này chúng ta phải viết hàm riêng cho nó.</p>\n<ul>\n<li>Tạo class <code class=\"language-text\">Custom.php</code> trong thư mục <code class=\"language-text\">common/tests/unit/faker/providers/</code></li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token keyword\">class</span> <span class=\"token class-name\">Custom</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\"><span class=\"token punctuation\">\\</span>Faker<span class=\"token punctuation\">\\</span>Provider<span class=\"token punctuation\">\\</span>Base</span>\n<span class=\"token punctuation\">{</span>\n   <span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">phoneVN</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n   <span class=\"token punctuation\">{</span>\n       <span class=\"token keyword\">return</span> <span class=\"token single-quoted-string string\">'+84'</span> <span class=\"token punctuation\">.</span> <span class=\"token function\">rand</span><span class=\"token punctuation\">(</span><span class=\"token number\">1610000000</span><span class=\"token punctuation\">,</span><span class=\"token number\">1699999999</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">//mình viết đơn giản thôi nhé</span>\n   <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>Thêm config <code class=\"language-text\">providers</code> như sau:</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token keyword\">return</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token single-quoted-string string\">'controllerMap'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span>\n        <span class=\"token single-quoted-string string\">'fixture'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span>\n            <span class=\"token single-quoted-string string\">'class'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token single-quoted-string string\">'yii\\faker\\FixtureController'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token single-quoted-string string\">'templatePath'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token single-quoted-string string\">'@common/tests/templates/fixtures'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// thư mục chứa template để định nghĩa cấu trúc dữ liệu</span>\n            <span class=\"token single-quoted-string string\">'fixtureDataPath'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token single-quoted-string string\">'@common/tests/fixtures/data'</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// file data sẽ được xuất ra ở đây</span>\n            <span class=\"token single-quoted-string string\">'providers'</span> <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span>\n                <span class=\"token single-quoted-string string\">'common\\tests\\unit\\faker\\providers\\Custom'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></code></pre></div>\n<ul>\n<li>Chạy lại command <code class=\"language-text\">php yii fixture/generate user</code> để xuất ra data.</li>\n</ul>","frontmatter":{"title":"Tạo dữ liệu mẫu với Yii 2 Faker","date":"2018-01-04","category":"Yii2","tags":["Yii2 Extension"]}}},"pageContext":{"slug":"/yii-2-tao-du-lieu-mau-voi-yii-2-faker/","previous":null,"next":{"fields":{"slug":"/dns-domain-to-github-page-ssl-cloudflare/"},"frontmatter":{"title":"DNS domain về Github Page và thiết lập SSL free thông qua Cloudflare","category":"Guide","tags":["github"]}}}}}